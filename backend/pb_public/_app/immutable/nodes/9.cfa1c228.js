import{s as he,i as Y,r as _e,h as be,k as Z}from"../chunks/scheduler.a6287574.js";import{S as ge,i as we,g as d,s as A,r as x,m as pe,h as p,j as I,B as ee,c as k,u as te,f as v,n as ve,k as s,a as F,x as i,v as ae,A as re,D as Ee,d as le,t as se,w as oe,e as ne,C as ye,o as Ie}from"../chunks/index.3e76b7a6.js";import{e as ie}from"../chunks/each.a5b882b1.js";import{I as Pe,P as $e}from"../chunks/Icon.8a942844.js";import{I as Le}from"../chunks/Input.ae2cab64.js";import"../chunks/paths.1b4de03e.js";import{g as ce,v as Ue}from"../chunks/utils.85594516.js";import"../chunks/Toaster.svelte_svelte_type_style_lang.3e69948a.js";import{p as Ae,U as z}from"../chunks/stores.10c58602.js";import{d as fe}from"../chunks/dummyAvatar.c3a90843.js";import{b as ke}from"../chunks/schemas.0ec87125.js";import{s as De}from"../chunks/index.3d80d59d.js";function ue(n,l,t){const e=n.slice();return e[5]=l[t],e}function me(n){let l,t=ie(n[0]?.avatar),e=[];for(let r=0;r<t.length;r+=1)e[r]=de(ue(n,t,r));return{c(){for(let r=0;r<e.length;r+=1)e[r].c();l=ne()},l(r){for(let c=0;c<e.length;c+=1)e[c].l(r);l=ne()},m(r,c){for(let a=0;a<e.length;a+=1)e[a]&&e[a].m(r,c);F(r,l,c)},p(r,c){if(c&1){t=ie(r[0]?.avatar);let a;for(a=0;a<t.length;a+=1){const f=ue(r,t,a);e[a]?e[a].p(f,c):(e[a]=de(f),e[a].c(),e[a].m(l.parentNode,l))}for(;a<e.length;a+=1)e[a].d(1);e.length=t.length}},d(r){r&&v(l),ye(e,r)}}}function de(n){let l,t,e=n[5]+"",r,c;return{c(){l=d("label"),t=d("span"),r=pe(e),c=A(),this.h()},l(a){l=p(a,"LABEL",{for:!0,class:!0});var f=I(l);t=p(f,"SPAN",{class:!0});var w=I(t);r=ve(w,e),w.forEach(v),c=k(f),f.forEach(v),this.h()},h(){s(t,"class","label-text-alt text-error"),s(l,"for","avatar"),s(l,"class","label py-0 pt-1")},m(a,f){F(a,l,f),i(l,t),i(t,r),i(l,c)},p(a,f){f&1&&e!==(e=a[5]+"")&&Ie(r,e)},d(a){a&&v(l)}}}function Be(n){let l,t,e,r="Update Profile",c,a,f,w='<span class="label-text">Profile Picture</span>',L,h,E,y,_,S,B,P,T,V,b,q,M,U,H,C,$,O,D,j,G;_=new Pe({props:{src:$e,class:"w-4 h-4"}});let u=n[0]?.avatar&&me(n);return U=new Le({props:{id:"name",label:"Name",value:n[2]?.name,disabled:n[1],errors:n[0]?.name}}),{c(){l=d("div"),t=d("form"),e=d("h3"),e.textContent=r,c=A(),a=d("div"),f=d("label"),f.innerHTML=w,L=A(),h=d("label"),E=d("label"),y=d("span"),x(_.$$.fragment),S=A(),B=d("div"),P=d("img"),V=A(),b=d("input"),q=A(),u&&u.c(),M=A(),x(U.$$.fragment),H=A(),C=d("div"),$=d("button"),O=pe("Update Profile"),this.h()},l(o){l=p(o,"DIV",{class:!0});var g=I(l);t=p(g,"FORM",{class:!0,enctype:!0});var m=I(t);e=p(m,"H3",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-1oqotgk"&&(e.textContent=r),c=k(m),a=p(m,"DIV",{class:!0});var N=I(a);f=p(N,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ee(f)!=="svelte-1tkerfi"&&(f.innerHTML=w),L=k(N),h=p(N,"LABEL",{for:!0,class:!0});var R=I(h);E=p(R,"LABEL",{for:!0,class:!0});var J=I(E);y=p(J,"SPAN",{class:!0});var K=I(y);te(_.$$.fragment,K),K.forEach(v),J.forEach(v),S=k(R),B=p(R,"DIV",{class:!0});var Q=I(B);P=p(Q,"IMG",{src:!0,alt:!0,id:!0}),Q.forEach(v),R.forEach(v),V=k(N),b=p(N,"INPUT",{type:!0,name:!0,id:!0,accept:!0}),N.forEach(v),q=k(m),u&&u.l(m),M=k(m),te(U.$$.fragment,m),H=k(m),C=p(m,"DIV",{class:!0});var W=I(C);$=p(W,"BUTTON",{class:!0,type:!0});var X=I($);O=ve(X,"Update Profile"),X.forEach(v),W.forEach(v),m.forEach(v),g.forEach(v),this.h()},h(){s(e,"class","text-2xl font-medium"),s(f,"for","avatar"),s(f,"class","label font-medium pb-1"),s(y,"class","btn btn-circle btn-sm btn-secondary"),s(E,"for","avatar"),s(E,"class","absolute -bottom-0.5 -right-0.5 hover:cursor-pointer"),Y(P.src,T=n[2]?.avatar?ce(n[2]?.collectionId,n[2]?.id,n[2]?.avatar):fe)||s(P,"src",T),s(P,"alt","user avatar"),s(P,"id","avatar-preview"),s(B,"class","w-32 rounded-full"),s(h,"for","avatar"),s(h,"class","avatar w-32 rounded-full hover:cursor-pointer"),s(b,"type","file"),s(b,"name","avatar"),s(b,"id","avatar"),b.value="",s(b,"accept","image/*"),b.hidden=!0,b.disabled=n[1],s(a,"class","form-control w-full max-w-lg"),s($,"class","btn btn-primary w-full max-w-lg"),s($,"type","submit"),$.disabled=n[1],s(C,"class","w-full max-w-lg pt-3"),s(t,"class","flex flex-col space-y-2 w-full"),s(t,"enctype","multipart/form-data"),s(l,"class","flex flex-col w-full h-full")},m(o,g){F(o,l,g),i(l,t),i(t,e),i(t,c),i(t,a),i(a,f),i(a,L),i(a,h),i(h,E),i(E,y),ae(_,y,null),i(h,S),i(h,B),i(B,P),i(a,V),i(a,b),i(t,q),u&&u.m(t,null),i(t,M),ae(U,t,null),i(t,H),i(t,C),i(C,$),i($,O),D=!0,j||(G=[re(b,"change",n[4]),re(t,"submit",Ee(n[3]))],j=!0)},p(o,[g]){(!D||g&4&&!Y(P.src,T=o[2]?.avatar?ce(o[2]?.collectionId,o[2]?.id,o[2]?.avatar):fe))&&s(P,"src",T),(!D||g&2)&&(b.disabled=o[1]),o[0]?.avatar?u?u.p(o,g):(u=me(o),u.c(),u.m(t,M)):u&&(u.d(1),u=null);const m={};g&4&&(m.value=o[2]?.name),g&2&&(m.disabled=o[1]),g&1&&(m.errors=o[0]?.name),U.$set(m),(!D||g&2)&&($.disabled=o[1])},i(o){D||(le(_.$$.fragment,o),le(U.$$.fragment,o),D=!0)},o(o){se(_.$$.fragment,o),se(U.$$.fragment,o),D=!1},d(o){o&&v(l),oe(_),u&&u.d(),oe(U),j=!1,_e(G)}}}function Ce(n,l,t){let e;be(n,z,w=>t(2,e=w));let r,c=!1;async function a(w){let L=new FormData(w.target);L.get("avatar").size===0&&L.delete("avatar");const{formData:E,err:y}=await Ue(L,ke);if(t(0,r=y?.fieldErrors),!y){t(1,c=!0);try{const{name:_,avatar:S}=await Ae.collection("users").update(e?.id,De.serialize(E));Z(z,e.name=_,e),Z(z,e.avatar=S,e)}catch(_){console.log(_.status,_.data)}t(1,c=!1)}}return[r,c,e,a,w=>{const h=w.target.files;if(h.length>0){const E=URL.createObjectURL(h[0]),y=document.getElementById("avatar-preview");y.src=E}}]}class Ge extends ge{constructor(l){super(),we(this,l,Ce,Be,he,{})}}export{Ge as component};
