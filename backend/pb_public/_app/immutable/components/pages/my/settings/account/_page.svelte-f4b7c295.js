import{S as re,i as ne,s as oe,M as R,k as E,a as D,l as $,m as w,h as c,c as I,n as m,b as S,H as _,N as j,O as z,P as Z,f as V,t as O,q as L,w as H,r as M,x as P,y as F,z as Y,U as fe,R as ie,Z as ue,B as G,a4 as X}from"../../../../../chunks/index-aedd6872.js";import{p as x,U as J}from"../../../../../chunks/stores-3f27b470.js";import{I as K}from"../../../../../chunks/Input-ab618a3e.js";import"../../../../../chunks/forms-f02374ed.js";import{v as ee}from"../../../../../chunks/utils-04416275.js";import{u as me,a as ce}from"../../../../../chunks/schemas-fdc952c7.js";const he=r=>({}),te=r=>({}),de=r=>({}),se=r=>({}),_e=r=>({}),ae=r=>({});function ge(r){let e,s,a,l,g,i,d,C,o,n,u,p;const k=r[3].trigger,U=R(k,r,r[2],ae),N=r[3].heading,b=R(N,r,r[2],se),q=r[3].default,v=R(q,r,r[2],null),T=r[3].actions,f=R(T,r,r[2],te);return{c(){e=E("label"),U&&U.c(),s=D(),a=E("input"),l=D(),g=E("label"),i=E("label"),d=E("div"),b&&b.c(),C=D(),o=E("div"),v&&v.c(),n=D(),u=E("div"),f&&f.c(),this.h()},l(t){e=$(t,"LABEL",{for:!0});var h=w(e);U&&U.l(h),h.forEach(c),s=I(t),a=$(t,"INPUT",{type:!0,id:!0,class:!0}),l=I(t),g=$(t,"LABEL",{for:!0,class:!0});var B=w(g);i=$(B,"LABEL",{for:!0,class:!0});var y=w(i);d=$(y,"DIV",{class:!0});var A=w(d);b&&b.l(A),A.forEach(c),C=I(y),o=$(y,"DIV",{class:!0});var Q=w(o);v&&v.l(Q),Q.forEach(c),n=I(y),u=$(y,"DIV",{class:!0});var W=w(u);f&&f.l(W),W.forEach(c),y.forEach(c),B.forEach(c),this.h()},h(){m(e,"for",r[0]),m(a,"type","checkbox"),m(a,"id",r[0]),m(a,"class","modal-toggle"),a.checked=r[1],m(d,"class","font-bold text-xl text-center"),m(o,"class","my-2"),m(u,"class","modal-action justify-center"),m(i,"for",""),m(i,"class","modal-box"),m(g,"for",r[0]),m(g,"class","modal modal-bottom sm:modal-middle ")},m(t,h){S(t,e,h),U&&U.m(e,null),S(t,s,h),S(t,a,h),S(t,l,h),S(t,g,h),_(g,i),_(i,d),b&&b.m(d,null),_(i,C),_(i,o),v&&v.m(o,null),_(i,n),_(i,u),f&&f.m(u,null),p=!0},p(t,[h]){U&&U.p&&(!p||h&4)&&j(U,k,t,t[2],p?Z(k,t[2],h,_e):z(t[2]),ae),(!p||h&1)&&m(e,"for",t[0]),(!p||h&1)&&m(a,"id",t[0]),(!p||h&2)&&(a.checked=t[1]),b&&b.p&&(!p||h&4)&&j(b,N,t,t[2],p?Z(N,t[2],h,de):z(t[2]),se),v&&v.p&&(!p||h&4)&&j(v,q,t,t[2],p?Z(q,t[2],h,null):z(t[2]),null),f&&f.p&&(!p||h&4)&&j(f,T,t,t[2],p?Z(T,t[2],h,he):z(t[2]),te),(!p||h&1)&&m(g,"for",t[0])},i(t){p||(V(U,t),V(b,t),V(v,t),V(f,t),p=!0)},o(t){O(U,t),O(b,t),O(v,t),O(f,t),p=!1},d(t){t&&c(e),U&&U.d(t),t&&c(s),t&&c(a),t&&c(l),t&&c(g),b&&b.d(t),v&&v.d(t),f&&f.d(t)}}}function pe(r,e,s){let{$$slots:a={},$$scope:l}=e,{label:g}=e,{checked:i}=e;return r.$$set=d=>{"label"in d&&s(0,g=d.label),"checked"in d&&s(1,i=d.checked),"$$scope"in d&&s(2,l=d.$$scope)},[g,i,l,a]}class le extends re{constructor(e){super(),ne(this,e,pe,ge,oe,{label:0,checked:1})}}function be(r){let e,s,a,l,g,i,d,C;return s=new K({props:{id:"email",type:"email",label:"Enter your new email address",required:!0,value:r[4]?.email,disabled:r[3],errors:r[0]?.email}}),{c(){e=E("form"),H(s.$$.fragment),a=D(),l=E("button"),g=L("Change my email"),this.h()},l(o){e=$(o,"FORM",{class:!0});var n=w(e);P(s.$$.fragment,n),a=I(n),l=$(n,"BUTTON",{type:!0,class:!0});var u=w(l);g=M(u,"Change my email"),u.forEach(c),n.forEach(c),this.h()},h(){m(l,"type","submit"),m(l,"class","btn btn-primary w-full"),l.disabled=r[3],m(e,"class","space-y-2")},m(o,n){S(o,e,n),F(s,e,null),_(e,a),_(e,l),_(l,g),i=!0,d||(C=ie(e,"submit",ue(r[5])),d=!0)},p(o,n){const u={};n&16&&(u.value=o[4]?.email),n&8&&(u.disabled=o[3]),n&1&&(u.errors=o[0]?.email),s.$set(u),(!i||n&8)&&(l.disabled=o[3])},i(o){i||(V(s.$$.fragment,o),i=!0)},o(o){O(s.$$.fragment,o),i=!1},d(o){o&&c(e),Y(s),d=!1,C()}}}function ve(r){let e,s;return{c(){e=E("span"),s=L("Change Email"),this.h()},l(a){e=$(a,"SPAN",{slot:!0,class:!0});var l=w(e);s=M(l,"Change Email"),l.forEach(c),this.h()},h(){m(e,"slot","trigger"),m(e,"class","btn btn-primary")},m(a,l){S(a,e,l),_(e,s)},p:G,d(a){a&&c(e)}}}function Ee(r){let e,s;return{c(){e=E("h3"),s=L("Change Your Email"),this.h()},l(a){e=$(a,"H3",{slot:!0});var l=w(e);s=M(l,"Change Your Email"),l.forEach(c),this.h()},h(){m(e,"slot","heading")},m(a,l){S(a,e,l),_(e,s)},p:G,d(a){a&&c(e)}}}function $e(r){let e,s,a,l,g,i,d,C;return s=new K({props:{id:"username",type:"text",label:"Enter your new username",required:!0,value:r[4]?.username,disabled:r[3],errors:r[0]?.username}}),{c(){e=E("form"),H(s.$$.fragment),a=D(),l=E("button"),g=L("Change my username"),this.h()},l(o){e=$(o,"FORM",{class:!0});var n=w(e);P(s.$$.fragment,n),a=I(n),l=$(n,"BUTTON",{type:!0,class:!0});var u=w(l);g=M(u,"Change my username"),u.forEach(c),n.forEach(c),this.h()},h(){m(l,"type","submit"),m(l,"class","btn btn-primary w-full"),l.disabled=r[3],m(e,"class","space-y-2")},m(o,n){S(o,e,n),F(s,e,null),_(e,a),_(e,l),_(l,g),i=!0,d||(C=ie(e,"submit",ue(r[6])),d=!0)},p(o,n){const u={};n&16&&(u.value=o[4]?.username),n&8&&(u.disabled=o[3]),n&1&&(u.errors=o[0]?.username),s.$set(u),(!i||n&8)&&(l.disabled=o[3])},i(o){i||(V(s.$$.fragment,o),i=!0)},o(o){O(s.$$.fragment,o),i=!1},d(o){o&&c(e),Y(s),d=!1,C()}}}function we(r){let e,s;return{c(){e=E("span"),s=L("Change Username"),this.h()},l(a){e=$(a,"SPAN",{slot:!0,class:!0});var l=w(e);s=M(l,"Change Username"),l.forEach(c),this.h()},h(){m(e,"slot","trigger"),m(e,"class","btn btn-primary")},m(a,l){S(a,e,l),_(e,s)},p:G,d(a){a&&c(e)}}}function Ce(r){let e,s;return{c(){e=E("h3"),s=L("Change Your Username"),this.h()},l(a){e=$(a,"H3",{slot:!0});var l=w(e);s=M(l,"Change Your Username"),l.forEach(c),this.h()},h(){m(e,"slot","heading")},m(a,l){S(a,e,l),_(e,s)},p:G,d(a){a&&c(e)}}}function Ue(r){let e,s,a,l,g,i,d,C,o,n,u,p,k,U,N,b,q,v,T;return C=new le({props:{label:"change-email",checked:r[1],$$slots:{heading:[Ee],trigger:[ve],default:[be]},$$scope:{ctx:r}}}),b=new K({props:{id:"username",label:"Username",value:r[4]?.username,disabled:!0}}),v=new le({props:{label:"change-username",checked:r[2],$$slots:{heading:[Ce],trigger:[we],default:[$e]},$$scope:{ctx:r}}}),{c(){e=E("div"),s=E("div"),a=E("h3"),l=L("Change Email"),g=D(),i=E("div"),d=D(),H(C.$$.fragment),o=D(),n=E("div"),u=E("h3"),p=L("Change Username"),k=D(),U=E("div"),N=D(),H(b.$$.fragment),q=D(),H(v.$$.fragment),this.h()},l(f){e=$(f,"DIV",{class:!0});var t=w(e);s=$(t,"DIV",{class:!0});var h=w(s);a=$(h,"H3",{class:!0});var B=w(a);l=M(B,"Change Email"),B.forEach(c),g=I(h),i=$(h,"DIV",{class:!0}),w(i).forEach(c),d=I(h),P(C.$$.fragment,h),h.forEach(c),o=I(t),n=$(t,"DIV",{class:!0});var y=w(n);u=$(y,"H3",{class:!0});var A=w(u);p=M(A,"Change Username"),A.forEach(c),k=I(y),U=$(y,"DIV",{class:!0}),w(U).forEach(c),N=I(y),P(b.$$.fragment,y),q=I(y),P(v.$$.fragment,y),y.forEach(c),t.forEach(c),this.h()},h(){m(a,"class","text-2xl font-medium"),m(i,"class","divider"),m(s,"class","w-full"),m(u,"class","text-2xl font-medium"),m(U,"class","divider mb-0.5"),m(n,"class","w-full"),m(e,"class","flex flex-col w-full h-full space-y-12")},m(f,t){S(f,e,t),_(e,s),_(s,a),_(a,l),_(s,g),_(s,i),_(s,d),F(C,s,null),_(e,o),_(e,n),_(n,u),_(u,p),_(n,k),_(n,U),_(n,N),F(b,n,null),_(n,q),F(v,n,null),T=!0},p(f,[t]){const h={};t&2&&(h.checked=f[1]),t&153&&(h.$$scope={dirty:t,ctx:f}),C.$set(h);const B={};t&16&&(B.value=f[4]?.username),b.$set(B);const y={};t&4&&(y.checked=f[2]),t&153&&(y.$$scope={dirty:t,ctx:f}),v.$set(y)},i(f){T||(V(C.$$.fragment,f),V(b.$$.fragment,f),V(v.$$.fragment,f),T=!0)},o(f){O(C.$$.fragment,f),O(b.$$.fragment,f),O(v.$$.fragment,f),T=!1},d(f){f&&c(e),Y(C),Y(b),Y(v)}}}function ye(r,e,s){let a;fe(r,J,n=>s(4,a=n));let l,g=!1,i=!1,d=!1;async function C(n){const{formData:u,err:p}=await ee(new FormData(n.target),me);if(s(0,l=p?.fieldErrors),!p){s(3,d=!0),s(1,g=!0);try{const{email:k}=await x.collection("users").requestEmailChange(u.email);X(J,a.email=k,a),s(1,g=!1)}catch(k){console.log(k.status,k.data)}s(3,d=!1)}}async function o(n){const{formData:u,err:p}=await ee(new FormData(n.target),ce);if(s(0,l=p?.fieldErrors),!p){s(3,d=!0),s(2,i=!0);try{const{username:k}=await x.collection("users").update(a.id,{username:u.username});X(J,a.username=k,a)}catch(k){console.log("This username has already been taken! Try another."),console.log(k.status,k.data)}s(3,d=!1),s(2,i=!1)}}return[l,g,i,d,a,C,o]}class Te extends re{constructor(e){super(),ne(this,e,ye,Ue,oe,{})}}export{Te as default};
