import{S as be,i as ge,s as we,k as d,q as O,a as A,w as re,l as p,m as _,r as T,h as u,c as D,x as le,n as s,W as se,b as Y,H as o,y as oe,R as ne,Z as Ee,f as ie,t as ce,z as fe,D as Pe,U as ye,e as ue,Y as Ie,u as $e,a4 as me}from"../../../../../chunks/index-aedd6872.js";import{I as Ue,P as Le}from"../../../../../chunks/Icon-befb2267.js";import{I as Ae}from"../../../../../chunks/Input-ab618a3e.js";import"../../../../../chunks/forms-f02374ed.js";import{g as de,v as De}from"../../../../../chunks/utils-04416275.js";import{p as Ne,U as W}from"../../../../../chunks/stores-3f27b470.js";import{d as pe}from"../../../../../chunks/dummyAvatar-d150dfe1.js";import{b as Se}from"../../../../../chunks/schemas-fdc952c7.js";import{s as Be}from"../../../../../chunks/index-3da723cb.js";function ve(i,l,a){const e=i.slice();return e[5]=l[a],e}function he(i){let l,a=i[0]?.avatar,e=[];for(let r=0;r<a.length;r+=1)e[r]=_e(ve(i,a,r));return{c(){for(let r=0;r<e.length;r+=1)e[r].c();l=ue()},l(r){for(let c=0;c<e.length;c+=1)e[c].l(r);l=ue()},m(r,c){for(let t=0;t<e.length;t+=1)e[t].m(r,c);Y(r,l,c)},p(r,c){if(c&1){a=r[0]?.avatar;let t;for(t=0;t<a.length;t+=1){const f=ve(r,a,t);e[t]?e[t].p(f,c):(e[t]=_e(f),e[t].c(),e[t].m(l.parentNode,l))}for(;t<e.length;t+=1)e[t].d(1);e.length=a.length}},d(r){Ie(e,r),r&&u(l)}}}function _e(i){let l,a,e=i[5]+"",r,c;return{c(){l=d("label"),a=d("span"),r=O(e),c=A(),this.h()},l(t){l=p(t,"LABEL",{for:!0,class:!0});var f=_(l);a=p(f,"SPAN",{class:!0});var v=_(a);r=T(v,e),v.forEach(u),c=D(f),f.forEach(u),this.h()},h(){s(a,"class","label-text-alt text-error"),s(l,"for","avatar"),s(l,"class","label py-0 pt-1")},m(t,f){Y(t,l,f),o(l,a),o(a,r),o(l,c)},p(t,f){f&1&&e!==(e=t[5]+"")&&$e(r,e)},d(t){t&&u(l)}}}function ke(i){let l,a,e,r,c,t,f,v,U,N,b,g,P,y,F,B,I,V,H,w,M,q,L,j,k,$,C,S,G,Z;y=new Ue({props:{src:Le,class:"w-4 h-4"}});let m=i[0]?.avatar&&he(i);return L=new Ae({props:{id:"name",label:"Name",value:i[2]?.name,disabled:i[1],errors:i[0]?.name}}),{c(){l=d("div"),a=d("form"),e=d("h3"),r=O("Update Profile"),c=A(),t=d("div"),f=d("label"),v=d("span"),U=O("Profile Picture"),N=A(),b=d("label"),g=d("label"),P=d("span"),re(y.$$.fragment),F=A(),B=d("div"),I=d("img"),H=A(),w=d("input"),M=A(),m&&m.c(),q=A(),re(L.$$.fragment),j=A(),k=d("div"),$=d("button"),C=O("Update Profile"),this.h()},l(n){l=p(n,"DIV",{class:!0});var E=_(l);a=p(E,"FORM",{class:!0,enctype:!0});var h=_(a);e=p(h,"H3",{class:!0});var J=_(e);r=T(J,"Update Profile"),J.forEach(u),c=D(h),t=p(h,"DIV",{class:!0});var R=_(t);f=p(R,"LABEL",{for:!0,class:!0});var K=_(f);v=p(K,"SPAN",{class:!0});var Q=_(v);U=T(Q,"Profile Picture"),Q.forEach(u),K.forEach(u),N=D(R),b=p(R,"LABEL",{for:!0,class:!0});var z=_(b);g=p(z,"LABEL",{for:!0,class:!0});var X=_(g);P=p(X,"SPAN",{class:!0});var x=_(P);le(y.$$.fragment,x),x.forEach(u),X.forEach(u),F=D(z),B=p(z,"DIV",{class:!0});var ee=_(B);I=p(ee,"IMG",{src:!0,alt:!0,id:!0}),ee.forEach(u),z.forEach(u),H=D(R),w=p(R,"INPUT",{type:!0,name:!0,id:!0,accept:!0}),R.forEach(u),M=D(h),m&&m.l(h),q=D(h),le(L.$$.fragment,h),j=D(h),k=p(h,"DIV",{class:!0});var ae=_(k);$=p(ae,"BUTTON",{class:!0,type:!0});var te=_($);C=T(te,"Update Profile"),te.forEach(u),ae.forEach(u),h.forEach(u),E.forEach(u),this.h()},h(){s(e,"class","text-2xl font-medium"),s(v,"class","label-text"),s(f,"for","avatar"),s(f,"class","label font-medium pb-1"),s(P,"class","btn btn-circle btn-sm btn-secondary"),s(g,"for","avatar"),s(g,"class","absolute -bottom-0.5 -right-0.5 hover:cursor-pointer"),se(I.src,V=i[2]?.avatar?de(i[2]?.collectionId,i[2]?.id,i[2]?.avatar):pe)||s(I,"src",V),s(I,"alt","user avatar"),s(I,"id","avatar-preview"),s(B,"class","w-32 rounded-full"),s(b,"for","avatar"),s(b,"class","avatar w-32 rounded-full hover:cursor-pointer"),s(w,"type","file"),s(w,"name","avatar"),s(w,"id","avatar"),w.value="",s(w,"accept","image/*"),w.hidden=!0,w.disabled=i[1],s(t,"class","form-control w-full max-w-lg"),s($,"class","btn btn-primary w-full max-w-lg"),s($,"type","submit"),$.disabled=i[1],s(k,"class","w-full max-w-lg pt-3"),s(a,"class","flex flex-col space-y-2 w-full"),s(a,"enctype","multipart/form-data"),s(l,"class","flex flex-col w-full h-full")},m(n,E){Y(n,l,E),o(l,a),o(a,e),o(e,r),o(a,c),o(a,t),o(t,f),o(f,v),o(v,U),o(t,N),o(t,b),o(b,g),o(g,P),oe(y,P,null),o(b,F),o(b,B),o(B,I),o(t,H),o(t,w),o(a,M),m&&m.m(a,null),o(a,q),oe(L,a,null),o(a,j),o(a,k),o(k,$),o($,C),S=!0,G||(Z=[ne(w,"change",i[4]),ne(a,"submit",Ee(i[3]))],G=!0)},p(n,[E]){(!S||E&4&&!se(I.src,V=n[2]?.avatar?de(n[2]?.collectionId,n[2]?.id,n[2]?.avatar):pe))&&s(I,"src",V),(!S||E&2)&&(w.disabled=n[1]),n[0]?.avatar?m?m.p(n,E):(m=he(n),m.c(),m.m(a,q)):m&&(m.d(1),m=null);const h={};E&4&&(h.value=n[2]?.name),E&2&&(h.disabled=n[1]),E&1&&(h.errors=n[0]?.name),L.$set(h),(!S||E&2)&&($.disabled=n[1])},i(n){S||(ie(y.$$.fragment,n),ie(L.$$.fragment,n),S=!0)},o(n){ce(y.$$.fragment,n),ce(L.$$.fragment,n),S=!1},d(n){n&&u(l),fe(y),m&&m.d(),fe(L),G=!1,Pe(Z)}}}function Re(i,l,a){let e;ye(i,W,v=>a(2,e=v));let r,c=!1;async function t(v){let U=new FormData(v.target);U.get("avatar").size===0&&U.delete("avatar");const{formData:b,err:g}=await De(U,Se);if(a(0,r=g?.fieldErrors),!g){a(1,c=!0);try{const{name:P,avatar:y}=await Ne.collection("users").update(e?.id,Be.serialize(b));me(W,e.name=P,e),me(W,e.avatar=y,e)}catch(P){console.log(P.status,P.data)}a(1,c=!1)}}return[r,c,e,t,v=>{const N=v.target.files;if(N.length>0){const b=URL.createObjectURL(N[0]),g=document.getElementById("avatar-preview");g.src=b}}]}class Ce extends be{constructor(l){super(),ge(this,l,Re,ke,we,{})}}export{Ce as default};
